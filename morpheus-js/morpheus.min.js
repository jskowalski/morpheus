define(function(e){var t=e("jquery");var n=e("pfa/utils");var r=function(){var e=null;var t=null;var n=function(t){e=t;return this};var r=function(t){if(e===null)return;e(t)};var i=function(e){t=e;return this};var s=function(e,n){if(t===null)return;t(e,n)};return{then:n,raiseThen:r,error:i,raiseError:s}};var i=function(e){var t=typeof e=="undefined"?{}:e;var n=typeof t.pageSize!=="undefined"?t.pageSize:10;var r=typeof t.pageIndex!=="undefined"?t.pageIndex:0;var i=typeof t.select!=="undefined"?t.select:"";var s=typeof t.from!=="undefined"?t.from:"";var o=typeof t.orderBy!=="undefined"?t.orderBy:"";var u=typeof t.where!=="undefined"?t.where:"";var a=typeof t.filter!=="undefined"?t.filter:"";var f=typeof t.include!=="undefined"?t.include:"";var l=typeof t.search!=="undefined"?t.search:"";var c=function(e){s=e;return this};var h=function(e){i=e;return this};var p=function(e){u=e;return this};var d=function(e){a=e;return this};var v=function(e,t){o=e+" "+t;return this};var m=function(e){f=e;return this};var g=function(e){l=e;return this};var y={select:h,from:c,where:p,filter:d,include:m,search:g,orderBy:v};Object.defineProperty(y,"entityName",{get:function(){return s}});Object.defineProperty(y,"pageSize",{get:function(){return n},set:function(e){n=e}});Object.defineProperty(y,"pageIndex",{get:function(){return r},set:function(e){r=e}});Object.defineProperty(y,"selectString",{get:function(){return i}});Object.defineProperty(y,"searchString",{get:function(){return l}});Object.defineProperty(y,"whereString",{get:function(){return u}});Object.defineProperty(y,"filterString",{get:function(){return a}});Object.defineProperty(y,"includeString",{get:function(){return f}});Object.defineProperty(y,"orderByString",{get:function(){return o}});Object.defineProperty(y,"commandType",{get:function(){return"query"}});return y};var s=function(){var e,t=null;var n=function(e){t=e;return this};var r=function(t){e=t;return this};var i={resource:n,body:r};Object.defineProperty(i,"entityName",{get:function(){return t}});Object.defineProperty(i,"data",{get:function(){return e}});Object.defineProperty(i,"commandType",{get:function(){return"command"}});return i};var o=function(e,t){t=typeof t!=="undefined"?t:false;var i=e;var s=[];var o=function(){return false};var u=function(e,t){var n=new r;i.getEntity(e,t).then(function(e){return n.raiseThen(e)});return n};var a=function(e){try{if(typeof e==="undefined"){throw"Morpheus says: No command present for resourceManager.execute(command)"}else if(e.commandType=="query"){return l(e)}else{return f(e)}}catch(t){console.error(t+" '"+e.entityName+"'")}};var f=function(e){var t=new r;i.executeCommand(e).then(function(e){t.raiseThen(e)}).error(function(e,n){t.raiseError(e,n)});return t};var l=function(e){var n=new r;if(t==true){n=h(e).then(function(t){if(typeof t!=="undefined"){c(e).then(function(e){n.raiseThen(e)}).error(function(e,t){n.raiseError(e,t)})}else{n.raiseThen(t)}})}else{c(e).then(function(e){n.raiseThen(e)}).error(function(e,t){n.raiseError(e,t)})}return n};var c=function(e){var t=new r;i.executeQuery(e).then(function(r){var i={header:{count:0},pageSize:e.pageSize,currentPageIndex:e.pageIndex,totalCount:0};if(r.header){i.header=r.header;if(r.header.primaryKeyName){i.header.primaryKeyName=n.toFirstLetterCamelCase(i.header.primaryKeyName)}if(r.header.resourceMap){header.resourceMap=r.header.resourceMap}if(r.header.resourceName){header.resourceName=r.header.resourceName}}if(r.data){if(r.data.items){i.items=r.data.items}else{i.data=r.data}if(r.data.totalCount){i.header.totalCount=r.data.totalCount}}else{if(Array.isArray(r)){i.items=r;i.header.count=r.length}else{i=r}}t.raiseThen(i)}).error(function(e,n){t.raiseError(e,n)});return t};var h=function(e){};return{getResourceById:u,execute:a}};var u=function(e){function c(e){var t="?limit="+e.pageSize+"&pageindex="+e.pageIndex;if(e.selectString){t=t+"&fields="+e.selectString}if(e.whereString){t=t+"&where="+e.whereString}if(e.filterString){t=t+"&filter="+e.filterString}if(e.orderByString){t=t+"&orderby="+e.orderByString}if(e.includeString){t=t+"&includes="+e.includeString}if(e.searchString){t=t+"&q="+e.searchString}return t}function h(e){for(var t=0;t<n.length;t++){if(n[t].rel.toLowerCase()===e.toLowerCase()){return n[t]}}throw"Route not found"}function p(e,t){var n=new r;var i="Bearer fa259b6d-ec0e-415d-9de4-40a17d64f5b3";var s={type:e.method,url:e.url,contentType:"application/json; charset=utf-8",dataType:"json",data:t,beforeSend:function(e){if(typeof i!=="undefined")e.setRequestHeader("Authorization",i)}};$.support.cors=true;console.group("Executing Morpheus Request: %s %s %o",s.type,s.url,s);$.ajax(s).done(function(e){console.info("Request Succeeded. Response: %o",e);console.groupEnd();n.raiseThen(e)}).fail(function(e,t){console.warn("Request Failed: %o, %o",e,t);console.groupEnd();n.raiseError(e,t)});return n}var t="restService";var n={};var e=e;var i=i;var s=s;var o=function(){var t=new r;p({url:e,method:"GET"}).then(function(e){n=e.links;t.raiseThen(e)});return t};var u=function(e){n=e};var a=function(t){var n=new r;var i=h(t.entityName);i.url=e+i.href+c(t);p(i).then(function(e){n.raiseThen(e)}).error(function(e,t){n.raiseError(e,t)});return n};var f=function(t){var n=new r;var i=h(t.entityName);i.url=e+i.href;p(i,t.data).then(function(e){n.raiseThen(e)}).error(function(e,t){n.raiseError(e,t)});return n};var l=function(t,n){var i=new r;var s=h(t);s.url=e+s.href+"/"+n;p(s).then(function(e){i.raiseThen(e)}).error(function(e,t){i.raiseError(e,t)});return i};var d=function(){if(n instanceof Array&&n.length>0){return true}else{return false}};return{name:t,getEntity:l,executeCommand:f,executeQuery:a,getRootLinks:o,setRootLinks:u,isHypermediaLoaded:d}};return{resourceManager:o,resourceQuery:i,resourceCommand:s,restService:u,promise:r}})